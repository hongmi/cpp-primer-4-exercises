(! ptr) == (ptr->next)
ch = (buf[bp++] != '\n')